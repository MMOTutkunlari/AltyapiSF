----------------------------------------------------
--COLLECT QUEST_lv80
--METIN2 Collecting Quest
----------------------------------------------------
quest collect_quest_lv80  begin
        state start begin
        end
        state run begin
                when login or levelup with pc.level >= 80 and not pc.is_gm() begin
                        set_state(information)
                end
        end

        state information begin
                when letter begin
                        local v = find_npc_by_vnum(20084)
                        if v != 0 then
                                target.vid("__TARGET__", v, "Chaegirap")
                        end
                        send_letter("Chaegirab'ýn isteði")
                end

                when button or info begin
						say_title("Chaegirab'ýn isteði")
                        say("")
                        say("Uriel'in öðrencisi Biyolog Chaegirab'ýn")
                        say("acil olarak yardýmýna ihtiyacý var.")
                        say("Haydi, onun yanýna git ve yardým et.")
                        say("")
                end

                when __TARGET__.target.click or
                        20084.chat."Tugyis Tabelasý " begin
                        target.delete("__TARGET__")
                        say_title("Chaegirab:")
                        say("")
			---                                                   l
                    	say("Hey!!! Merhaba. Seni tekrar gördüðüme sevindim.")
                        say("Su aralar Yýlan Vadisi hakkýnda")
                        say("yazýyorum. Aslýnda bunu kendim baþarmam")
                        say("gerekiyor, ama tek baþýma baþaramam....Benim için")
                        say("bunu yapar mýsýn? Tabii ki, yardýmlarýn")
                        say("karþýlýðýnda çok iyi ödüllendirileceksin.")
                        wait()
                        say_title("Chaegirab:")
                        say("Gayretini takdir ediyorum. ")
                        say("Daha önce Yýlan Vadisi'ni hiç duydun")
                        say("mu? Yüksek daðlar ve çöllerden oluþan bir alan.")
                        say("Esrarengiz sýlahlarý ve zýrhlarý ile vadiyi")
                        say("koruyan gerçekten korkunç hayaletler var.")
                        say("Bunlar dev gibi ve çok güçlü hayaletler.")
                        say("Beni ilgilendir kýsmý, doguþtan savasçý hayaleti")
                        say("olaný... Lütfen bana bu hayalet savasçý")
                        say("hakkýnda bir kanýt getir.")
                        say("")
                        wait()
                        say_title("Chaegirab")
						say("")
                        say("Bu mümkün mü?")
                        say("Orada þu anda bir çok sahte kanýt var. Sahteleri")
                        say("kullanamam...")
                        say("30 Savasçý Hayaleti deliline ihtiyacým var...")
                        say("Iyi þanslar!")
                        say("")
                        set_state(go_to_disciple)
                        pc.setqf("duration",0)  
                        pc.setqf("collect_count",0)
                        pc.setqf("drink_drug",0)
			end
        end
        state go_to_disciple begin
                when letter begin
                        send_letter("Biyoloðun incelemesi")

                end
                when button or info begin
                        say_title("Devler Diyarýndan Tugyis Tabelasý ")
                        ---                                                   l
                        say("")
                        say("Uriel'in çýraðý Chaegirab, Yýlan " )
                        say("Vadisindeki Hayalet Savasçýlarý inceliyor.")
                        say("Bu hayalet savasçýlar karþý konulmaz güçleriyle")
                        say("tanýnýyorlar. Bu hayaletlerden Chaegirab'a 30")
                        say("Tugyis Tabelasý getirmen gerekiyor.")
                        say("")
                        say_item_vnum(30166)
                        say_reward("Þimdiye kadar ".." "..pc.getqf("collect_count").." tane tabela topladýn.")
                        say("")
                end

                when 71035.use begin 
                        if get_time() < pc.getqf("duration") then
                                say("Mucize suyu kullanamazsin")
                                return
                        end
                        if pc.getqf("drink_drug")==1 then
                                say("Zaten kullandin.")
                                return
                        end
                        if pc.count_item(30166)==0 then
                                say_title("Chaegirab:")
								say("")
                                say("Savasçý hayaletlerini düzenlediðin sürece,")
                                say("mucize suyu kullanabilirsin.")
                                say("")
                                return
                        end

                        item.remove()
                        pc.setqf("drink_drug",1)
					end
					when kill begin
				if  npc.get_race() == 1401 or  npc.get_race() == 1402 or npc.get_race() == 1403 or npc.get_race() == 1601 or npc.get_race() == 1602 or 1603 then
						local s = number(1, 100)
							if s == 1  then
								pc.give_item2(30166)
								send_letter("Tugyis Tabelasý buldun")		
							end
						end
						end			
            when 20084.chat."Tugyis Tabelasý " with pc.count_item(30166) >0   begin
                        if get_time() > pc.getqf("duration") then
                                say_title("Chaegirab")
                                ---                                                   l
                                say("")
                                say("Oh!! Bana bir delil mi getirdin...")
                                say("Kontrol edeceðim..")
                                say("Bir dakika lütfen..")
                                say("")
                                pc.remove_item(30166, 1)
								if  is_test_server()  then 
									pc.setqf("duration",get_time()+2) 
								else
									pc.setqf("duration",get_time()+1) -----------------------------------22½Ã°£
								end
                                wait()
                                
								local pass_percent
                                if pc.getqf("drink_drug")==0 then
                                        pass_percent=60
                                else
                                        pass_percent=90
                                end

                                local s= number(1,100)
                                if s<= pass_percent  then
                                   if pc.getqf("collect_count")< 29 then     --weniger als 30
                                                local index =pc.getqf("collect_count")+1
                                                pc.setqf("collect_count",index)                                                     
												say("Chaegirab:")
                                                say("Ohh!! Muhteþem! Teþekkürler...")
                                                say("Geriye ".." "..30-pc.getqf("collect_count").. " tane kaldý.")
                                                say("Bol þans!")
                                                say("")
                                                pc.setqf("drink_drug",0)                                                         
												return
                                        end
                                        say_title("Chaegirab:")
                                        say("30 delili de topladýn!!")
                                        say("Geriye sadece hayalet savasçýlarýnýn Ruh")
                                        say("Taþý'ný almak kaldý, bu anahtar görevi yapacak.")
                                        say("Ruh Taþý'ný vadideki hayalet savasçýlardan")
                                        say("kazanabilirsin. Bunu benim için")
                                        say("yapar misin?")
                                        say("")
                                        pc.setqf("collect_count",0)
                                        pc.setqf("drink_drug",0)
                                        pc.setqf("duration",0)
                                        set_state(key_item)
                                        return
                                else
                                say_title("Chaegirab:")
                                say("Hmm..Bu yanlýþ...")
                                say("Üzgünüm, bunu kullanamam.")
                                say("Bu taþýn içinde farklý güçler olabilir.")
                                say("Lütfen, baþka bir tane bul.")
                                say("")
                                pc.setqf("drink_drug",0)                                         
								return
                                end
                  else
                  say_title("Chaegirab:")
				  say("")
				  ---                                                   l
                  say("Son derece üzgünüm...")
                  say("Henüz bana getirdiðin diðer tabelayý ")
                  say("incelemeyi bitirmedim.....")
                  say("Hmm, çok üzgünüm.... Diðerini daha sonra getirebilir misin?")
                  say("")
                  return
                end

end
end


        state key_item begin
                when letter begin
                        send_letter("Chaegirab'ýn araþtýrmasý ")

                        if pc.count_item(30225)>0 then
                                local v = find_npc_by_vnum(20084)
                                if v != 0 then
                                        target.vid("__TARGET__", v, "Chaegirap")
                                end
                        end

                end
                when button or info begin
                        if pc.count_item(30225) >0 then
                                say_title("Tugyinin Ruh Taþý ")
                                say("")
                                ---                                                   l
                                say("Sonunda Tugyinin Ruh Taþý'ný buldun.")
                                say("Onu Chaegirab'a götür.")
                                say("")
                                return
                        end

                        say_title("Tugyinin Ruh Taþý ")
                        say("")
                        ---                                                   l
                        say("Uriel'in çýraðý Chaegirab'ýn araþtýrmasý için ")
                        say("hayalet savasçýlara ait 30 Tugyis Tabelasý topladýn.")
                        say("Son olarak ihtiyaç duyulan Tugyinin")
                        say("Ruh Taþý.")
                        say_item_vnum(30225)
                        say("Onu Yýlan Vadisindeki hayalet savasçýlardan ")
                        say("kazanabilirsin. Onu Chaegirab'a ver.")
                        say("")
                        say("")
                end


					when kill begin
					if npc.get_race() == 1401 or npc.get_race() == 1402 or npc.get_race() == 1403 or npc.get_race() == 1601 or npc.get_race() == 1602 or npc.get_race() == 1603 then
                        local s = number(1,200)
                        if s==1 then
                                pc.give_item2(30225,1)
                                send_letter("Tugyinin Ruh Taþý'ný kazandýn.")
                        end
                end
				end




                when __TARGET__.target.click  or
                        20084.chat."Ruh Taþý'ný buldun." with pc.count_item(30225) > 0  begin
                    target.delete("__TARGET__")
                        say_title("Chaegirab:")
			say("")
			---                                                   l
                        say("Ohh!!! Teþekkürler.. Teþekkürler..")
                        say("Ödül olarak senin iç güçlerini artýracaðým..")
                        say("Bu gizli bir reçete, içinde bu güçlerle ilgili")
                        say("gerekli bilgiler var...")
                        say("Bunu Baek-Go'ya ver. Sana bir güç iksiri ")
                        say("hazýrlayacak. Iyi eðlenceler!")
                        say("Teþekkür ederim, sayende hayalet savasçýlarý ")
                        say("artýk biliyorum!")
                        say("")
                        pc.remove_item(30225,1)
                        set_state(__reward)
                end

        end

        state __reward begin
                when letter begin
                        send_letter("Chaegirab'ýn ödülü ")

                        local v = find_npc_by_vnum(20018)
                        if v != 0 then
                                target.vid("__TARGET__", v, "Baek Go")
                        end

                end
                when button or info begin
                        say_title("Chaegirab'ýn ödülü ")
                        ---                                                   l
                        say("Tabelalarýn ve ruh taþýnýn ödülü olarak")
                        say("biyolog Chaegirab sana gizli bir reçete verdi.")
                        say("Þimdi Baek-Go'ya git, senin için mucizevi bir ")
                        say("iksir yapacak.")
                end

                when __TARGET__.target.click  or
                        20018.chat."Gizli Reçete"  begin
                    target.delete("__TARGET__")
                        say_title("Baek-Go:")
						say("Ah, bu biyolog Chaegirab'ýn gizli reçetesi mi?")
                        say("Hm, bu saldýrý deðerini %10 ve saldýrý hýzýný 6")
                        say("puan artýracak. Ýþte iksirin!")
                        wait()
                        say_title("Baek-Go:")
						say("Ayný zamanda sana bu Mavi Abanoz Sandýðý da")
                        say("vermeliyim. Ona iyi bak.")
                        say_reward("Chagirab'ýn isteðini tamamladýðýn için kalýcý ")
                        say_reward("olarak saldýrý deðerin %10 ve saldýrý hýzýn 6")
                        say_reward("puan arttý.")
						affect.remove_collect(apply.ATT_SPEED, 5, 60*60*24*365*60)
                        affect.add_collect(apply.ATT_SPEED,11,60*60*24*365*60) --60Jahre
						affect.add_collect_point(POINT_ATT_BONUS,10,60*60*24*365*60) --60³â	
                        pc.give_item2("50114",1)
						pc.delqf("collect_count")
                        clear_letter()
						set_quest_state("collect_quest_lv85", "run")
                        set_state(__complete)
                end

        end


        state __complete begin
        end
end
